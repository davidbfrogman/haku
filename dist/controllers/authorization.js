"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constants_1 = require("../constants");
const api_error_handler_1 = require("../api-error-handler");
class Authz {
    static isMatchBetweenRoleLists(userRoles, authRoles) {
        return userRoles.some(r => authRoles.indexOf(r) >= 0);
    }
    static permit(...authRoles) {
        return (request, res, next) => {
            var token = request[constants_1.CONST.REQUEST_TOKEN_LOCATION];
            if (token && token.userId && token.roles && this.isMatchBetweenRoleLists(token.roles, authRoles))
                next(); // role is allowed, so continue on the next middleware
            else {
                api_error_handler_1.ApiErrorHandler.sendAuthFailure(res, 403, 'You are not in the correct role for this resource');
            }
        };
    }
}
exports.Authz = Authz;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZlYnJvd24vRG9jdW1lbnRzL2hha3Uvc2VydmVyL2NvbnRyb2xsZXJzL2F1dGhvcml6YXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSw0Q0FBcUM7QUFFckMsNERBQXVEO0FBRXZEO0lBRVcsTUFBTSxDQUFDLHVCQUF1QixDQUFDLFNBQW1CLEVBQUUsU0FBbUI7UUFDMUUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFTSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsU0FBbUI7UUFDdkMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUMxQixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsaUJBQUssQ0FBQyxzQkFBc0IsQ0FBa0IsQ0FBQztZQUNuRSxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUM3RixJQUFJLEVBQUUsQ0FBQyxDQUFDLHNEQUFzRDtZQUNsRSxJQUFJLENBQUMsQ0FBQztnQkFDRixtQ0FBZSxDQUFDLGVBQWUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLG1EQUFtRCxDQUFDLENBQUM7WUFDbkcsQ0FBQztRQUNMLENBQUMsQ0FBQTtJQUNMLENBQUM7Q0FDSjtBQWhCRCxzQkFnQkMiLCJmaWxlIjoiY29udHJvbGxlcnMvYXV0aG9yaXphdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIG1pZGRsZXdhcmUgZm9yIGRvaW5nIHJvbGUtYmFzZWQgcGVybWlzc2lvbnNcbmltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UsIFJlcXVlc3RQYXJhbUhhbmRsZXIsIE5leHRGdW5jdGlvbiwgUmVxdWVzdEhhbmRsZXIsIEFwcGxpY2F0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBDb25maWcgfSBmcm9tIFwiLi4vY29uZmlnL2NvbmZpZ1wiO1xuaW1wb3J0IHsgSVRva2VuUGF5bG9hZCB9IGZyb20gXCIuLi9tb2RlbHMvaW5kZXhcIjtcbmltcG9ydCB7IENPTlNUIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgQXV0aGVudGljYXRpb25Db250cm9sbGVyIH0gZnJvbSBcIi4vYXV0aGVudGljYXRpb24uY29udHJvbGxlclwiO1xuaW1wb3J0IHsgQXBpRXJyb3JIYW5kbGVyIH0gZnJvbSBcIi4uL2FwaS1lcnJvci1oYW5kbGVyXCI7XG5cbmV4cG9ydCBjbGFzcyBBdXRoeiB7XG5cbiAgICBwdWJsaWMgc3RhdGljIGlzTWF0Y2hCZXR3ZWVuUm9sZUxpc3RzKHVzZXJSb2xlczogc3RyaW5nW10sIGF1dGhSb2xlczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHVzZXJSb2xlcy5zb21lKHIgPT4gYXV0aFJvbGVzLmluZGV4T2YocikgPj0gMCk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBwZXJtaXQoLi4uYXV0aFJvbGVzOiBzdHJpbmdbXSk6IChyZXF1ZXN0OiBhbnksIHJlczogYW55LCBuZXh0OiBhbnkpID0+IHZvaWQge1xuICAgICAgICByZXR1cm4gKHJlcXVlc3QsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgICAgICAgdmFyIHRva2VuID0gcmVxdWVzdFtDT05TVC5SRVFVRVNUX1RPS0VOX0xPQ0FUSU9OXSBhcyBJVG9rZW5QYXlsb2FkO1xuICAgICAgICAgICAgaWYgKHRva2VuICYmIHRva2VuLnVzZXJJZCAmJiB0b2tlbi5yb2xlcyAmJiB0aGlzLmlzTWF0Y2hCZXR3ZWVuUm9sZUxpc3RzKHRva2VuLnJvbGVzLCBhdXRoUm9sZXMpKVxuICAgICAgICAgICAgICAgIG5leHQoKTsgLy8gcm9sZSBpcyBhbGxvd2VkLCBzbyBjb250aW51ZSBvbiB0aGUgbmV4dCBtaWRkbGV3YXJlXG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBBcGlFcnJvckhhbmRsZXIuc2VuZEF1dGhGYWlsdXJlKHJlcywgNDAzLCAnWW91IGFyZSBub3QgaW4gdGhlIGNvcnJlY3Qgcm9sZSBmb3IgdGhpcyByZXNvdXJjZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19
